---
title: Nuxt3 è¸©å‘ç¬”è®°
date: 2022-07-02
updated: 2022-07-02
categories:
  - å­¦ä¹ ç¬”è®°
  - å‰ç«¯
tags:
  - Nuxt3
  - SSR
---

æœ€è¿‘æå¯¼å¸ˆé‚£è¾¹çš„é¡¹ç›®ï¼Œä½†ç”±äºå­¦é•¿é‚£è¾¹ä¼ æ‰¿ä¸‹æ¥çš„é¡¹ç›®å¤ªè‡ƒè‚¿äº†ï¼ˆå› ä¸ºé‚£ä¸ªå­¦é•¿ä¹Ÿæ˜¯ä»åˆ«çš„é¡¹ç›®æ”¹è¿‡æ¥çš„ã€‚ã€‚ã€‚ï¼‰ï¼Œæ”¹èµ·æ¥å¾ˆä¸æ–¹ä¾¿ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿè·Ÿä¸å¤ªä¸Šäº†ï¼Œå› æ­¤æˆ‘æ‰“ç®—é‡å¤´è‡ªå·±å†™ä¸€ä¸ª

æœ€åç ”ç©¶äº†ä¸€ä¸‹å†³å®šé‡‡ç”¨ Vue3 + Vite + Pinia + ts + Nuxt3 çš„æ–¹æ¡ˆï¼Œè¿™æ˜¯å› ä¸ºè¿™é¡¹ç›®åŸæœ¬å°±æ˜¯ Vue2 çš„é¡¹ç›®ï¼Œæ­£å¥½ç°åœ¨ Vue3 ä¹Ÿå¾ˆæˆç†Ÿäº†ï¼Œå°±å¹²è„†ç›´æ¥æ¢æˆäº† Vue3 ï¼Œç„¶åå¯»æ‰¾ Vue3 çš„æœ€ä½³å®è·µå°±æœ‰äº† Viteã€Piniaå’Œ tsï¼Œè‡³äº Nuxt3 æ˜¯å› ä¸ºæƒ³å°è¯•ä¸€ä¸‹æœåŠ¡ç«¯æ¸²æŸ“ï¼Œä½† Nodejs æˆ‘ä¸å¤ªç†Ÿï¼ŒåŠ ä¸Š Vue3 çš„ SSR ç½‘ä¸Šç›¸å…³æ•™ç¨‹å¾ˆå°‘ï¼Œå› æ­¤æœ€åè¿˜æ˜¯å†³å®šé‡‡ç”¨ Nuxt3ï¼Œä¸è¿‡è¿™ç©æ„å„¿æ­£å¼ç‰ˆæ˜¯ä¸€ä¸ªæœˆå‰æ‰å‘å¸ƒçš„ï¼Œç½‘ä¸Šæ•™ç¨‹ä¹Ÿå¾ˆå°‘ï¼Œè€Œä¸”å®˜æ–¹æ–‡æ¡£ä¼¼ä¹ä¹Ÿè¿˜æ˜¯åœ¨å®Œå–„ä¸­ï¼Œå› æ­¤å‘æœ‰ç‚¹å¤šã€‚ã€‚ã€‚

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»ä¸€ä¸ªæ¨¡æ¿æ¥å¼€å§‹æ„å»ºï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ [antfu/vitesse-nuxt3: Vitesse for Nuxt 3 ğŸ”ğŸ’šâš¡ï¸ (github.com)](https://github.com/antfu/vitesse-nuxt3)ï¼Œvitesse æ˜¯æˆ‘æ¯”è¾ƒä¸‹æ¥æˆ‘è®¤ä¸ºæœ€æ¥è¿‘æˆ‘ç†æƒ³ä¸­çš„æœ€ä½³å®è·µçš„æ¨¡æ¿ï¼Œè€Œä¸”è¿˜åˆšå¥½æœ‰ Nuxt3 ç‰ˆæœ¬çš„ï¼Œè€Œä¸”ä½œè€… Anthony Fu æ˜¯ Vue, Vite, Nuxt æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ VueUse, Vitest ç­‰å®˜æ–¹ç”Ÿæ€å·¥å…·çš„ä½œè€…ï¼Œè¿™ä»½æ¨¡æ¿çš„è´¨é‡åº”è¯¥è¿˜æ˜¯æœ‰ä¿è¯çš„

## å®‰è£…

å®‰è£…æˆ‘æ˜¯ç›´æ¥ç”¨æ¨¡æ¿ä»“åº“åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œç›´æ¥ clone ä¸‹æ¥çš„

ç„¶ååªéœ€è¦ `pnpm i ` å®‰è£…ä¾èµ–åŒ…å°±è¡Œäº†

è¿è¡Œçš„æ—¶å€™å°±å‡ºç°äº†ä¸€äº›å¥‡æ€ªçš„åœ°æ–¹

æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œåº”è¯¥ç”¨ `pnpm run dev -- -o` å¯åŠ¨

![image-20220521225823122](https://img.blueflame.org.cn/images/2022/05/21/6288fe06b8310.png)

ä½†æˆ‘è¿™è¾¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿™ä¹ˆå¯åŠ¨çš„è¯ï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º`-o/.nuxt` ç›®å½•ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£å¸¸çš„ï¼Œ `-o `ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¢«å½“ä½œäº†ä¸€ä¸ªæ–‡ä»¶ç›®å½•åï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œæ”¹ç”¨ `pnpm run dev -o` åæ‰ä¼šæ­£å¸¸ç”Ÿæˆ`.nuxt` ç›®å½•å¹¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çª—å£

å¦å¤–ä¸€ä¸ªå‘å°±æ˜¯ï¼Œåœ¨ windows ä¸‹ï¼Œå¦‚æœå¼€å¯äº† vitenode åŠŸèƒ½ï¼Œå°±ä¼šå› ä¸ºè·¯å¾„å¯¼è‡´è¯·æ±‚å¤±è´¥

![image-20220521222213062](https://img.blueflame.org.cn/images/2022/05/21/6288f593d2588.png)

è¯¥ bug å·²ç»ä¿®å¤å®Œæ¯•ï¼Œåªä¸è¿‡è¿˜æ²¡æœ‰å‘å¸ƒåˆ°æ–°çš„åŒ…é‡Œï¼Œå› æ­¤ windows ä¸‹åªèƒ½æš‚æ—¶å…³é—­è¿™ä¸ªåŠŸèƒ½ï¼Œä¿®æ”¹ `nuxt.config.ts` ï¼Œå¦å¤–å°±æ˜¯é»˜è®¤å¯åŠ¨æ˜¯ï¼Œä¼šæ€»æ˜¯æœ‰é€‰é¡¹æ¥é—®ä½ ï¼Œæ˜¯å¦æ„¿æ„è®©å®ƒæ”¶é›†ä½ çš„æ•°æ®æ¥è¿›è¡Œé¥æµ‹ï¼Œå°±å¾ˆçƒ¦ï¼Œå¯ä»¥è®¾ç½® `telemetry` ä¸º false æ¥å…³é—­

```typescript
export default defineNuxtConfig({
  experimental: {
    viteNode: false,
  },
  telemetry: false,
})

```

## å¯¼å…¥ UI åº“

è¿™åˆæ˜¯ä¸€æ³¢è¡€å‘ï¼Œå› ä¸ºæƒ³æ¢ä¸ª UI åº“ï¼ŒåŠ ä¸Š element plus ä¼¼ä¹ bug ä¹Ÿä¸å°‘ï¼Œå› æ­¤é€‰æ‹©äº† å°¤å¤§æ›¾ç»æ¨èè¿‡çš„ Naive UIï¼Œä¸è¿‡å› ä¸ºè¿™ä¸ª UI åº“çš„å®ç°æ–¹å¼ä¼¼ä¹å’Œå…¶ä»–ä¸»æµçš„æœ‰æ‰€ä¸åŒï¼ŒåŠ ä¸Šç›¸å¯¹å¤§å‚çš„ UI åº“æ›´å†·é—¨ï¼Œä¼¼ä¹å‘ä¹Ÿä¸å°‘

é¦–å…ˆå‚è€ƒæ–‡æ¡£å®‰è£… `naive-ui` å’Œ `@css-render/vue3-ssr`ï¼Œç„¶åæŒ‰ç…§å®˜æ–¹çš„ä¾‹å­ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ æ’ä»¶ï¼Œä¸è¿‡è¿™æ ·æ²¡æ³•ä½¿ç”¨åˆ° nuxt çš„è‡ªåŠ¨å¯¼å…¥åŠŸèƒ½ï¼Œå› æ­¤å¦‚æœæƒ³å®ç°è‡ªåŠ¨å¯¼å…¥ï¼Œéœ€è¦å®‰è£… `unplugin-vue-components` è¿™ä¸ª Vite æ’ä»¶æ¥å®ç°

å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶

```typescript
import { defineNuxtConfig } from 'nuxt'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { NaiveUiResolver } from 'unplugin-vue-components/resolvers'

export default defineNuxtConfig({
  modules: [
    '@vueuse/nuxt',
    '@unocss/nuxt',
    '@pinia/nuxt',
    '@nuxtjs/color-mode',
  ],
  experimental: {
    reactivityTransform: true,
    viteNode: false,
  },
  unocss: {
    preflight: true,
  },
  colorMode: {
    classSuffix: '',
  },
  vite: {
    plugins: [
      AutoImport({
        resolvers: [NaiveUiResolver()],// æ­¤å¤„æ²¡æœ‰æ•ˆæœï¼Œå®˜æ–¹æ²¡æä¾›å‡½æ•°å¯¼å‡ºçš„æ¥å£ï¼Œå¯ä»¥åˆ äº†
      }),
      Components({
        resolvers: [NaiveUiResolver()], // Automatically register all components in the `components` directory
      }),
    ],
  },
  build: {
    transpile: [
      'naive-ui',
      'vueuc',
      '@css-render/vue3-ssr',
      '@juggle/resize-observer',
    ],
  },
})

```

## åˆ·æ–°æ•°æ®

åœ¨åšéªŒè¯ç ç‚¹å‡»åˆ·æ–°è¿™ä¸ªåŠŸèƒ½æ—¶ï¼Œå‘ç°ç›´æ¥å†æ¬¡è°ƒç”¨ useFetch å»å‘è¯·æ±‚çš„è¯ï¼Œè™½ç„¶è¯·æ±‚æ­£å¸¸çš„å‘é€äº†ï¼Œä½†é¡µé¢å¹¶æ²¡æœ‰å“åº”å¼çš„å˜åŒ–ï¼Œåæ¥ç½‘ä¸ŠæŸ¥äº†åŠå¤©ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³çš„èµ„æ–™ï¼Œæœ€åæ˜¯ç¿»äº†åŠå¤©å®˜æ–¹æ–‡æ¡£æ‰å‘ç°ï¼Œæ˜¯éœ€è¦è°ƒç”¨ç¬¬ä¸€æ¬¡ useFetch è¿”å›çš„ä¸€ä¸ª refresh å‡½æ•°æ¥å†æ¬¡è·å–æ•°æ®ï¼Œä¸‹é¢æ˜¯å®˜æ–¹æ–‡æ¡£åŸæ–‡

[Refreshing Data](https://v3.nuxtjs.org/guide/features/data-fetching#refreshing-data)

Sometimes throughout the course of your user's page visit, you may need to refresh the data loaded from the API. This can happen if the user chooses to paginate, filter results, search, etc.

You can make use of the `refresh()` method returned from the `useFetch()` composable to refresh the data with different query parameters:

```html
<script setup>
const page = ref(1);

const { data: users, pending, refresh, error } = await useFetch(() => `users?page=${page.value}&take=6`, { baseURL: config.API_BASE_URL }
);

function previous(){
  page.value--;
  refresh();
}

function next() {
  page.value++;
  refresh();
}
</script>
```

The key to making this work is to call the `refresh()` method returned from the `useFetch()` composable when a query parameter has changed.
